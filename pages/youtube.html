<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Customized AI Karaoke</title>
        <link rel="stylesheet" href="../style.css" />
    </head>
    <body>
        <div id="wrapper">
            <h1>❷ Please insert a youtube link</h1>
            <input type="text" id="input" placeholder="insert youtube link" />
            <button onclick="submitYoutube()" id="submit-youtube-button">
                Submit
            </button>
        </div>
        <script>
        function submitYoutube() {
            var currentUrl = new URL(window.location.href);
            var usernote = currentUrl.searchParams.get('usernote');
            var youtubeUrl = new URL(document.getElementById('input').value);
            var youtubeID = youtubeUrl.searchParams.get('v');
            var wrapper = document.getElementById('wrapper');

            wrapper.innerHTML = `
                <h1>Please wait</h1>
            `;

            // <<<<<< 지우지 마세요! >>>>>>>
            // get mp3 file link from youtube link
            // async function getMP3() {
            //     const response = await fetch(
            //         `https://youtube-to-mp32.p.rapidapi.com/yt_to_mp3?video_id=${youtubeID}`,
            //         {
            //             method: 'GET',
            //             headers: {
            //                 'x-rapidapi-key':
            //                     '76b3ab0246mshe435987951b0de0p106ccajsn5eadd7215507',
            //                 'x-rapidapi-host': 'youtube-to-mp32.p.rapidapi.com',
            //             },
            //         }
            //     );
            //     const responseData = await response.json();
            //     console.log(responseData);
            //     wrapper.innerHTML += `
            //         <div><img src="${responseData.Video_Thumbnail}" alt="${responseData.Title}"></div>
            //         <a href="${responseData.Download_url}" id="downloadYT">Download MP3</a>
            //     `;
            //     var downloadEl = document.getElementById('downloadYT');
            //     downloadEl.click();
            // }
            // getMP3();

            // temporary code not to use api
            wrapper.innerHTML += `
                <div><img src="https://img1.daumcdn.net/thumb/R720x0.q80/?scode=mtistory2&fname=http%3A%2F%2Fcfile7.uf.tistory.com%2Fimage%2F24283C3858F778CA2EFABE" alt="적재-풍경"></div>
                <a href="https://www.bensound.com/bensound-music/bensound-jazzyfrenchy.mp3" id="downloadYT">Download MP3</a>
                `;
            var downloadEl = document.getElementById('downloadYT');
            downloadEl.click();

            setTimeout(function () {
                window.location.href = '/pages/processing.html?usernote=' + usernote;
            }, 2000);
        }
        </script>
    </body>
</html>
